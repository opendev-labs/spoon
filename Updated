// Updated tank-operator.js
class RealTankOperator {
  constructor() {
    this.ai = new RealAIService();
    this.executor = new TerminalExecutor();
    this.creator = new RealProjectCreator();
    this.database = new DatabaseAutomation();
    this.mode = 'OPERATOR';
    this.operations = [];
  }

  async operateSpoon() {
    console.log('ğŸ® TANK: "I have the controls. SPOON AI Terminal activated."');
    console.log('ğŸ’¬ Natural language commands supported:');
    console.log('   "Create a React app with MongoDB backend"');
    console.log('   "Deploy my app to Vercel"');
    console.log('   "Set up a Node.js API with PostgreSQL"');
    console.log('   "Dockerize my application"');

    await this.startInteractiveMode();
  }

  async startInteractiveMode() {
    const rl = readline.createInterface({
      input: process.stdin,
      output: process.stdout,
      prompt: `TANK@${this.mode}:~$ `
    });

    rl.prompt();

    rl.on('line', async (line) => {
      const input = line.trim();
      
      if (input === 'exit') {
        console.log('ğŸ‘‹ TANK: "We\'re done here."');
        rl.close();
        return;
      }

      await this.processNaturalLanguage(input);
      rl.prompt();
    });

    rl.on('close', () => {
      console.log('ğŸ”„ Returning to mainframe...');
      process.exit(0);
    });
  }

  async processNaturalLanguage(input) {
    console.log(`ğŸ¤” Processing: "${input}"`);
    
    // Parse with AI
    const aiResponse = await this.ai.processCommand(input);
    
    if (aiResponse.commands && aiResponse.commands.length > 0) {
      console.log(`ğŸ“‹ SPOON AI Plan: ${aiResponse.explanation}`);
      
      if (aiResponse.confirmation_required) {
        console.log('âš ï¸  Risks:', aiResponse.risks.join(', '));
      }
      
      // Execute the commands
      const results = await this.executor.executeCommandList(aiResponse.commands);
      
      // Log operation
      this.operations.push({
        input,
        aiResponse,
        results,
        timestamp: new Date().toISOString()
      });
      
      console.log(`âœ… Operation completed. ${results.filter(r => r.success).length}/${results.length} successful`);
    } else {
      console.log('âŒ No automation found for this request');
      console.log('ğŸ’¡ Try: "create react app my-app", "deploy to vercel", "setup mongodb"');
    }
  }
}
